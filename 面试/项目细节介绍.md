# 兵棋态势推演

**2024.04~**至今       中国科学院软件研究所（天基重点实验室）    C++开发工程师

**项目简介**：《冰棋推演》用于地图战略部署，兵棋态势推演。项目对标美国军事部署兵棋系统，现在处于第三期开发，已部署使用。前端ui界面用**Qt**实现,后端用主要用**C++**,2D通过**OpenGL**对点军标进行绘制逻辑和图形渲染，3D使用**OSG**。

**个人职责**：参与《冰棋推演》2D兵棋部分绘制渲染的开发以及维护。

**成果描述：**

1、使用**FreeType**库，为2D军标库设计开发出一套**文字库系统**；

2、开发新功能，如鼠标跟**随点军标绘制**，修复UI界面与后端的**对接错误**问题；

3、使用**信号槽**、**多线程**，大幅度减少了**UI**界面加载速度，由原来的2s，降低到100ms。

4、编写需求相关算法，如**自相交多边形填充算法**、**多级渐进纹理算法**、**抽稀算法**等；



1、

（1）将要使用的字体和大小使用字体库来加载和渲染字体为位图。

（2）使用opengl将文字渲染到位图上，要记录每个字符的纹理坐标和大小信息。

（3）根据位置、纹理坐标顶点数据，绘制到屏幕

实现的功能有：字体旋转、字体样式的选择替换、字体大小控制、粗体样式、斜体样式、下划线、删除线等

2、

（1）难点在于要梳理清楚项目整体逻辑，鼠标点击事件的判断，点军标类根据时间生成唯一ID,存入军标容器里面，右击、以及替换军标则删除军标ID。

（2）对接错误包括一些军标生成的算法错误、军标填充消失、填充闪烁、填充图案跑到线性容器下面等等。

3、

（1）针对项目启动绘制地图再绘制属性面板里面的军标数据，导致项目启动过慢的问题，使用信号和信号槽在启动时在另一个线程加载军标数据绘制。遇到的难题，传递过去的C++容器数据在QT上面无法检测到，接收不到信号，解决办法是将该容器自定义为Qt可检测类型；会收到传递信号两次，导致属性面板重复绘制，原因是未接收到信号重复触发信号。

4、

（1）自相交多边形算法：在线军标填充绘制时，opengl只能绘制凸多边形，对于自相交的凹多边形无法处理。将图案打散为三角形绘制，对点重新进行排序。

（2）多级渐进纹理算法：加载分辨率最高的原始纹理级别，然后逐级递减纹理分辨率来生成Mipmap级别，存储在纹理对象中。opengl会自动选择合适大小的纹理。

（3）抽稀算法：在绘制军标时，由于点数量过多导致使用opengl绘制虚线时，点和点之间间隔太紧密，绘制出来的图像虚线很少。将点和点之间的像素距离设置成一定值，选择性收纳满足这个距离点坐标。然后重新绘制。

# 毁灭砖块

2023.06~至今          个人项目：毁灭砖块          技术：C++、OpenGL、Windows、CMake、Git
介绍：2D类型游戏，防止小球掉落并击毁所有砖块通关。
1、实现了游戏内球体与砖块、墙面的检测碰撞
2、美化小球在运动过程中的运动轨迹，添加拖尾粒子特效。
3、为了增加游戏趣味性，添加小球在捡到道具后会撞击窗口的震动特效。

游戏框架理解：采用单一性原则，游戏模块来管理游戏代码，资源管理器专门用来处理加载shader和纹理路径得载入。游戏内的物体砖块为基类，后续添加物体在此基础上进行派生。

（1）碰撞检测算法改进优化：原来的轴对齐碰撞箱，根据物体位置来判断是否发生碰撞检测，大致思路是判断两物体是否有重合部分，如果有则发生碰撞。但是假如我的物体是个圆形，如何判断他是否发生检测碰撞？解决办法就是找到球体距离方形物体最近的点P，再判断这点距离是否与圆心的距离大于半径。如何求P点？可以通过计算物体之间的矢量差值和方形物体的半边长范围，通过这个范围来限制矢量插值，最后最近点P就是物体中心坐标加上修正后的矢量插值。

（2）粒子特效实现思路：实现类似于拖尾的特效，实则是众多微粒在一起沿着运动方向位移，设置一个粒子的结构体，里面包含他的位置、速度、颜色和生命，在构造的时候给他们赋值。指定一定总量的粒子，缩小十倍渲染绘制。每帧更新得时候，检测生命值为0的粒子的索引生成新的粒子，并且更新大于0的生命的值。

（3）特效实现：往游戏中添加道具成员，在拾取道具后触发特效的实现，包括撞击晃动、倒置画面、还有混沌效果。撞击晃动实现通过触发修改顶点着色器的位置使他发生一个微小的变化，在片段着色器实现模糊效果。导致画面直接颠倒顶点着色器的x,y坐标值，然后在片段着色器纹理颜色翻转。混沌效果的实现是基于顶点着色器位置随着时间变化，呈现出画面左右随时间位移，顶点着色器纹理和边缘卷积核乘积呈现出一种混沌画风，增加游戏趣味性。